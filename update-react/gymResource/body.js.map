{"version":3,"sources":["body.jsx"],"names":[],"mappings":"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","file":"body.js","sourcesContent":["import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport {Spin} from \"antd\";\r\n\r\nimport Header from \"./header\";\r\nimport SelectWeek from \"./selectWeek\";\r\nimport BookContainer from \"./bookContainer\";\r\nimport Warn from \"./warn\";\r\nimport Book from \"./book\";\r\nvar main = document.getElementById(\"main\")\r\n\r\nclass Body extends React.Component {\r\n    constructor() {\r\n        super()\r\n    }\r\n\r\n    componentWillMount() {\r\n        this.state = {\r\n            weeks: [],//周\r\n            title: \"选择场地\",\r\n            bookData: [],//预定的数据\r\n            active: 0,//当前选中的周\r\n            gymid: \"\",\r\n            gymname: \"\",\r\n            fiedid: \"\",\r\n            loading: true,\r\n            msg: \"\",//错误信息\r\n            orderNum: []//TODO 选中的订单\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        $($(\"head\").find(\"style\")[0]).remove();//删除antd组件的通用样式,避免覆盖\r\n        // var timers = moment().format(\"YYYYMMDD\");\r\n        // var testId = \"gymid=f8d5e740-91a8-11e6-9c3c-25a22e7c8c34&fiedid=9e05aeb7-bd23-4205-af3a-1f5513568af9&date=\" + timers + \"&gymname=宁夏亲水体育中心篮球场#2\";\r\n        var _id = window.location.search.slice(1);\r\n        var hash = window.location.hash[1];//获取哈希值,0为当天,以此类推;\r\n        var _this = this;\r\n        var weeks,\r\n            date,\r\n            gymid,\r\n            fiedid,\r\n            gymname,\r\n            title;\r\n        $.ajax({\r\n            url: \"/sport/gymresource?\" + _id,\r\n            type: \"get\",\r\n            success: function (data) {\r\n                if (data) {\r\n                    if (data.weeks) {\r\n                        weeks = data.weeks;\r\n                    }\r\n                    title = data.title\r\n                    if (data.params) {\r\n                        date = data.params.date\r\n                        gymid = data.params.gymid\r\n                        fiedid = data.params.fiedid\r\n                        gymname = data.params.gymname\r\n                    }\r\n                    _this.setState({\r\n                            weeks: weeks,\r\n                            title: title,\r\n                            gymid: gymid,\r\n                            gymname: gymname,\r\n                            /*TODO active为hash值，用户选中的那天*/\r\n                            active: hash,\r\n                            fiedid: fiedid\r\n                        },\r\n                        function () {\r\n                            //获取日期选择信息，成功后在获取价格\r\n                            if (date && gymid && fiedid) {\r\n                                _this.getPrice(date, gymid, fiedid)\r\n                            }\r\n                        }\r\n                    )\r\n                }\r\n            }\r\n        })\r\n        setInterval(function () {\r\n            var f = false;\r\n            //实实更新状态\r\n            _this.updateSelect()\r\n            // 提交订单前判断选中的是否超时\r\n            if (_this.state.orderNum.length == 0) {\r\n                return;\r\n            }\r\n            var updateOrderNum = [];\r\n            var newOrderNum = _this.state.orderNum\r\n            for (var i = 0; i < newOrderNum.length; i++) {\r\n                if ((newOrderNum[i].date + newOrderNum[i].startTime.split(\":\").join(\"\")) > moment().format(\"YYYYMMDDHHmmss\")) {\r\n                    updateOrderNum.push(newOrderNum[i]);\r\n                    continue;\r\n                }\r\n                f = true;\r\n            }\r\n            if (f) {\r\n                _this.setState({orderNum: updateOrderNum})\r\n            }\r\n\r\n        }, 500)\r\n    }\r\n\r\n    getPrice(date, gymid = this.state.gymid, fiedid = this.state.fiedid) {\r\n        var _this = this\r\n        $.ajax({\r\n            beforeSend: function () {\r\n                _this.setState({loading: true})\r\n            },\r\n            url: \"/sport/clm/resource?\" + \"gymid=\" + gymid + \"&fiedid=\" + fiedid + \"&date=\" + date,\r\n            type: \"get\",\r\n            success: function (data) {\r\n                //设定类名,区分已预订,未预定,已过期\r\n                if (data && Array.isArray(data) && data.length > 0) {\r\n                 //   var nowDate = data[0][0].beginTime.slice(0, 8)//获取日期\r\n                   // var selectDate = _this.state.orderNum.length > 0 ? _this.state.orderNum[0].date : 0;\r\n                    //var pos = selectDate == 0 ? [] : _this.state.orderNum.map(index=>(index.siteNo + index.startTime))\r\n                    var newData = data.map(index=> {\r\n                        return index.map(v=> {\r\n                            v.className = moment().format(\"YYYYMMDDHHmmss\") > v.beginTime ? \"overtime\" : v.num==1 ?\"available\" : \"sold\";\r\n                            return v;\r\n                        })\r\n                    })\r\n                    _this.setState({bookData: newData, loading: false});\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    updateSelect() {\r\n        //时时更新,判断所选订单是否过期\r\n        var f = false;\r\n        var oldState = this.state.bookData;\r\n        var newData = oldState.map(index=> {\r\n            return index.map(v=> {\r\n                if (moment().format(\"YYYYMMDDHHmmss\") > v.beginTime && v.className != \"overtime\") {\r\n                    v.className = \"overtime\";\r\n                    f = true;\r\n                }\r\n                return v;\r\n            })\r\n        })\r\n        if (f) {\r\n            this.setState({bookData: newData});\r\n        }\r\n    }\r\n\r\n    book(num, newName, mation) {\r\n        /**\r\n         * mation  携带信息\r\n         * num     获取位置\r\n         * newName 新的类名 select/available/overtime\r\n         * * @type {Array}\r\n         */\r\n\r\n        var results = [];\r\n        var oldName = this.state.bookData;\r\n        var pos = num.split(\"|\")[0]\r\n        var p1 = pos.split(\",\")[0];\r\n        var p2 = pos.split(\",\")[1];\r\n        mation.date = num.split(\"|\")[2];//获取当天日期\r\n        if (newName == \"selected\" && this.state.orderNum.length == 0) {\r\n            results.push(mation);\r\n            oldName[p1][p2].className = newName;\r\n        } else {\r\n            //取消\r\n            if (newName != \"selected\") {\r\n                for (var i = 0; i < this.state.orderNum.length; i++) {\r\n                    if (mation.pos != this.state.orderNum[i].pos) {\r\n                        results.push(this.state.orderNum[i])\r\n                    }\r\n                }\r\n                oldName[p1][p2].className = newName;\r\n            } else {\r\n                //预定，判断预定的个数是否大于四条\r\n                if (this.state.orderNum.length == 4) {\r\n                    this.setMsg(\"每次只能预定四条\")\r\n                    return;\r\n                } else {\r\n                    results = this.state.orderNum;\r\n                    results.push(mation);\r\n                    oldName[p1][p2].className = newName;\r\n                }\r\n            }\r\n        }\r\n        this.setState({\r\n            orderNum: results,\r\n            bookData: oldName\r\n        })\r\n    }\r\n\r\n    clearMsg() {\r\n        this.setState({msg: \"\"})\r\n    }\r\n\r\n    clearOrder() {\r\n        this.setState({\r\n            orderNum: []\r\n        })\r\n    }\r\n\r\n    setMsg(msg) {\r\n        this.setState({msg: msg})\r\n    }\r\n    clearLoading(){\r\n        this.setState({loading:false})\r\n    }\r\n    render() {\r\n        return (<div className=\"container\">\r\n            <Header h1={this.state.title}/>\r\n            <SelectWeek\r\n                clearOrder={()=> {\r\n                    this.clearOrder()\r\n                }}\r\n                date={this.state.weeks}\r\n                getData={(date)=> {\r\n                    this.getPrice(date)\r\n                }}\r\n                active={this.state.active}\r\n            />\r\n            <BookContainer\r\n                clearLoading={()=>{this.clearLoading()}}\r\n                bookData={this.state.bookData}\r\n                setMsg={(msg)=> {\r\n                    this.setMsg(msg)\r\n                }}\r\n                setClassName={(num, newName, mation)=> {\r\n                    this.book(num, newName, mation)\r\n                }}\r\n            />\r\n            <Warn msg={this.state.msg}\r\n                  clearMsg={()=> {\r\n                      this.clearMsg()\r\n                  }\r\n                  }/>\r\n            <Book orderNum={this.state.orderNum}\r\n                  gymname={this.state.gymname}\r\n                  gymid={this.state.gymid}\r\n            />\r\n            <div style={{\r\n                display: this.state.loading ? \"block\" : \"none\",\r\n                zIndex: \"100\",\r\n                textAlign: \"center\",\r\n                position: \"fixed\",\r\n                top: 0,\r\n                bottom: 0,\r\n                width: \"100%\",\r\n                backgroundColor: \"#000000\",\r\n                opacity: \"0.6\"\r\n            }}>\r\n                <Spin style={{position: \"absolute\", top: \"50%\", marginLeft: \"-25.21px\", marginTop: \"-25px\"}}\r\n                      tip=\"Loading...\" size=\"large\"\r\n                      spinning={this.state.loading}/>\r\n            </div>\r\n        </div>)\r\n    }\r\n}\r\n\r\nReactDOM.render(<Body/>, main)\r\n"]}